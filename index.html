<!DOCTYPE html>

<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bastos Lanches PDV</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }


    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #FFD700 0%, #DC143C 100%);
        min-height: 100vh;
        color: #333;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    .header {
        background: rgba(255, 255, 255, 0.95);
        padding: 20px;
        border-radius: 15px;
        text-align: center;
        margin-bottom: 30px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .logo-section {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 20px;
        margin-bottom: 10px;
    }

    .logo-placeholder {
        width: 80px;
        height: 80px;
        background: linear-gradient(45deg, #DC143C, #FFD700);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 32px;
        font-weight: bold;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    /* Estilo para quando usar logo real */
    .logo-real {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid #DC143C;
        box-shadow: 0 4px 15px rgba(220, 20, 60, 0.3);
    }

    h1 {
        color: #2c3e50;
        font-size: 2.5em;
        font-weight: 700;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }

    .subtitle {
        color: #7f8c8d;
        font-size: 1.2em;
        margin-top: 5px;
    }

    .main-menu {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .menu-card {
        background: rgba(255, 255, 255, 0.95);
        padding: 25px;
        border-radius: 15px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .menu-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        background: rgba(255, 255, 255, 1);
        border: 2px solid #FFD700;
    }

    .menu-icon {
        font-size: 3em;
        margin-bottom: 15px;
        display: block;
    }

    .menu-card h3 {
        color: #2c3e50;
        margin-bottom: 10px;
        font-size: 1.3em;
    }

    .menu-card p {
        color: #7f8c8d;
        font-size: 0.9em;
    }

    .content-area {
        background: rgba(255, 255, 255, 0.95);
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        display: none;
    }

    .content-area.active {
        display: block;
    }

    .btn {
        background: linear-gradient(45deg, #DC143C, #B22222);
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1em;
        font-weight: 600;
        transition: all 0.3s ease;
        margin: 5px;
    }

    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        filter: brightness(1.1);
    }

    .btn-secondary {
        background: linear-gradient(45deg, #95a5a6, #7f8c8d);
    }

    .btn-danger {
        background: linear-gradient(45deg, #e74c3c, #c0392b);
    }

    .btn-success {
        background: linear-gradient(45deg, #FFD700, #FFA500);
        color: #333;
        font-weight: bold;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #2c3e50;
    }

    .form-group input, .form-group select {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 1em;
        transition: border-color 0.3s ease;
    }

    .form-group input:focus, .form-group select:focus {
        outline: none;
        border-color: #DC143C;
        box-shadow: 0 0 0 3px rgba(220, 20, 60, 0.1);
    }

    .table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .table th {
        background: linear-gradient(45deg, #DC143C, #B22222);
        color: white;
        padding: 15px;
        text-align: left;
        font-weight: 600;
    }

    .table td {
        padding: 12px 15px;
        border-bottom: 1px solid #f0f0f0;
    }

    .table tr:hover {
        background-color: #fff8dc;
    }

    .carrinho {
        background: linear-gradient(45deg, #FFD700, #FFFF99);
        padding: 20px;
        border-radius: 15px;
        margin: 20px 0;
        color: #333;
        border: 2px solid #DC143C;
    }

    .carrinho h3 {
        margin-bottom: 15px;
        color: #333;
        font-weight: bold;
    }

    .carrinho-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid rgba(220, 20, 60, 0.2);
    }

    .carrinho-total {
        font-size: 1.5em;
        font-weight: bold;
        text-align: center;
        margin-top: 15px;
        color: #333;
        background: rgba(220, 20, 60, 0.1);
        padding: 10px;
        border-radius: 8px;
    }

    .alert {
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
        font-weight: 500;
    }

    .alert-success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }

    .alert-error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }

    .back-btn {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1000;
        background: rgba(255, 215, 0, 0.9);
        border: 2px solid #DC143C;
        border-radius: 50px;
        padding: 15px;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
    }

    .back-btn:hover {
        transform: scale(1.1);
        background: #FFD700;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }

    .stat-card {
        background: linear-gradient(45deg, #FFD700, #FFA500);
        color: #333;
        padding: 20px;
        border-radius: 15px;
        text-align: center;
        border: 2px solid #DC143C;
        box-shadow: 0 4px 15px rgba(220, 20, 60, 0.2);
    }

    .stat-number {
        font-size: 2em;
        font-weight: bold;
        margin-bottom: 5px;
        color: #DC143C;
    }

    .payment-methods {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin: 20px 0;
    }

    .payment-method {
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .payment-method:hover, .payment-method.selected {
        border-color: #DC143C;
        background: linear-gradient(45deg, #DC143C, #B22222);
        color: white;
    }

    .chart-bar {
        display: flex;
        align-items: center;
        margin: 10px 0;
        padding: 10px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        border-left: 4px solid #DC143C;
    }

    .chart-date {
        width: 100px;
        font-weight: bold;
        color: #2c3e50;
    }

    .chart-value {
        flex: 1;
        height: 20px;
        background: linear-gradient(90deg, #FFD700, #DC143C);
        border-radius: 10px;
        margin: 0 15px;
    }

    .chart-amount {
        font-weight: bold;
        color: #DC143C;
    }

    @media (max-width: 768px) {
        .container {
            padding: 10px;
        }
        
        h1 {
            font-size: 2em;
        }
        
        .main-menu {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }
        
        .logo-section {
            flex-direction: column;
            gap: 10px;
        }

        .back-btn {
            padding: 10px;
            top: 10px;
            left: 10px;
        }
    }

    /* Animações extras */
    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    
    .carrinho-item {
        animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Estilo especial para campos no carrinho */
    .carrinho input {
        border: 2px solid #DC143C;
        background: white;
        color: #333;
    }

    .carrinho input:focus {
        border-color: #FFD700;
        background: #fffacd;
    }
</style>


</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-section">
                <!-- ÁREA PARA LOGO - Agora dinâmica -->
                <div id="logo-container">
                    <img src="bastos.jpeg" alt="Logo" class="logo-real" id="logo-imagem">
                </div>
                <div>
                    <h1 id="titulo-empresa">Bastos Lanches</h1>
                    <p class="subtitle" id="subtitulo-sistema">Sistema de Venda Bastos</p>
                </div>
            </div>
        </div>


    <button class="back-btn" onclick="voltarMenu()" style="display: none;">
        <span style="font-size: 1.5em; color: #DC143C;">←</span>
    </button>

    <div id="main-menu" class="main-menu">
        <div class="menu-card" onclick="mostrarSecao('cadastro-produto')">
            <span class="menu-icon">📦</span>
            <h3>Cadastrar Produto</h3>
            <p>Adicione novos produtos ao sistema</p>
        </div>
        <div class="menu-card" onclick="mostrarSecao('listar-produtos')">
            <span class="menu-icon">📋</span>
            <h3>Listar Produtos</h3>
            <p>Visualize todos os produtos cadastrados</p>
        </div>
        <div class="menu-card" onclick="mostrarSecao('nova-venda')">
            <span class="menu-icon">🛒</span>
            <h3>Nova Venda</h3>
            <p>Inicie uma nova venda</p>
        </div>
        <div class="menu-card" onclick="mostrarSecao('relatorios')">
            <span class="menu-icon">📊</span>
            <h3>Relatórios</h3>
            <p>Visualize relatórios de vendas</p>
        </div>
        <div class="menu-card" onclick="mostrarSecao('ajustes')">
            <span class="menu-icon">⚙️</span>
            <h3>Ajustes</h3>
            <p>Configure o sistema</p>
        </div>
    </div>

    <!-- Seção Cadastro de Produto -->
    <div id="cadastro-produto" class="content-area">
        <h2>📦 Cadastrar Produto</h2>
        <form id="form-produto">
            <div class="form-group">
                <label for="nome-produto">Nome do Produto:</label>
                <input type="text" id="nome-produto" required>
            </div>
            <div class="form-group">
                <label for="preco-produto">Preço (R$):</label>
                <input type="number" id="preco-produto" step="0.01" min="0" required>
            </div>
            <div class="form-group">
                <label for="estoque-produto">Estoque (deixe vazio para ilimitado):</label>
                <input type="number" id="estoque-produto" min="0">
            </div>
            <button type="submit" class="btn btn-success">Cadastrar Produto</button>
        </form>
    </div>

    <!-- Seção Listar Produtos -->
    <div id="listar-produtos" class="content-area">
        <h2>📋 Produtos Cadastrados</h2>
        <div id="lista-produtos"></div>
    </div>

    <!-- Seção Nova Venda -->
    <div id="nova-venda" class="content-area">
        <h2>🛒 Nova Venda</h2>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
            <div>
                <h3>Adicionar Produto</h3>
                <div class="form-group">
                    <label for="produto-venda">Produto:</label>
                    <select id="produto-venda">
                        <option value="">Selecione um produto</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="quantidade-venda">Quantidade:</label>
                    <input type="number" id="quantidade-venda" min="1" value="1">
                </div>
                <button onclick="adicionarAoCarrinho()" class="btn">Adicionar ao Carrinho</button>
            </div>
            <div>
                <div class="carrinho">
                    <h3>🛒 Carrinho</h3>
                    <div id="carrinho-itens"></div>
                    <div class="carrinho-total" id="carrinho-total">Total: R$ 0,00</div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="finalizarVenda()" class="btn btn-success">Finalizar Venda</button>
                        <button onclick="limparCarrinho()" class="btn btn-danger">Limpar Carrinho</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Finalização -->
    <div id="modal-finalizacao" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%; border: 3px solid #FFD700;">
            <h3 style="color: #DC143C;">💳 Finalizar Venda</h3>
            <div id="resumo-venda"></div>
            <h4 style="color: #DC143C;">Forma de Pagamento:</h4>
            <div class="payment-methods">
                <div class="payment-method" onclick="selecionarPagamento('pix')">
                    <div style="font-size: 2em;">📱</div>
                    <div>PIX</div>
                </div>
                <div class="payment-method" onclick="selecionarPagamento('cartao')">
                    <div style="font-size: 2em;">💳</div>
                    <div>Cartão</div>
                </div>
                <div class="payment-method" onclick="selecionarPagamento('dinheiro')">
                    <div style="font-size: 2em;">💵</div>
                    <div>Dinheiro</div>
                </div>
            </div>
            <div id="pagamento-pix" style="display: none;">
                <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 10px; margin: 15px 0;">
                    <h4 style="color: #DC143C; margin-bottom: 15px;">📱 Pagamento PIX</h4>
                    <div id="qr-code-container" style="margin: 20px 0;">
                        <div id="qr-code-placeholder" style="width: 200px; height: 200px; background: #e9ecef; border: 2px dashed #ccc; margin: 0 auto; display: flex; align-items: center; justify-content: center; border-radius: 10px;">
                            <span style="color: #6c757d;">QR Code será gerado aqui</span>
                        </div>
                    </div>
                    <div id="info-pix" style="background: white; padding: 15px; border-radius: 8px; border: 2px solid #FFD700;">
                        <p><strong>Valor:</strong> R$ <span id="valor-pix">0,00</span></p>
                        <p id="nome-recebedor-pix"><strong>Recebedor:</strong> Configure nas Ajustes</p>
                        <p id="banco-info-pix"></p>
                    </div>
                    <p style="margin-top: 10px; font-size: 0.9em; color: #6c757d;">
                        Aponte a câmera do seu celular para o QR Code ou copie a chave PIX
                    </p>
                </div>
            </div>
            <div id="pagamento-dinheiro" style="display: none;">
                <div class="form-group">
                    <label for="valor-pago">Valor Pago (R$):</label>
                    <input type="number" id="valor-pago" step="0.01" min="0">
                </div>
                <div id="troco-info"></div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button onclick="confirmarVenda()" class="btn btn-success">Confirmar Venda</button>
                <button onclick="fecharModal()" class="btn btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Seção Ajustes -->
    <div id="ajustes" class="content-area">
        <h2>⚙️ Configurações do Sistema</h2>
        
        <!-- Configurações Gerais -->
        <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 2px solid #FFD700;">
            <h3 style="color: #DC143C; margin-bottom: 15px;">🏪 Informações da Empresa</h3>
            <div class="form-group">
                <label for="nome-sistema">Nome do Sistema:</label>
                <input type="text" id="nome-sistema" placeholder="Ex: Bastos Lanches PDV">
            </div>
            <div class="form-group">
                <label for="nome-empresa">Nome da Empresa:</label>
                <input type="text" id="nome-empresa" placeholder="Ex: Bastos Lanches">
            </div>
            <div class="form-group">
                <label for="url-logo">URL da Logo (deixe vazio para usar logo padrão):</label>
                <input type="url" id="url-logo" placeholder="https://exemplo.com/logo.png">
            </div>
            <button onclick="salvarConfiguracoesGerais()" class="btn btn-success">Salvar Configurações</button>
        </div>

        <!-- Configurações PIX -->
        <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 2px solid #FFD700;">
            <h3 style="color: #DC143C; margin-bottom: 15px;">📱 Configurações PIX</h3>
            <div class="form-group">
                <label for="chave-pix">Chave PIX:</label>
                <input type="text" id="chave-pix" placeholder="Ex: 11999999999 ou email@exemplo.com">
            </div>
            <div class="form-group">
                <label for="nome-pix">Nome do Recebedor:</label>
                <input type="text" id="nome-pix" placeholder="Ex: João Silva">
            </div>
            <div class="form-group">
                <label for="cidade-pix">Cidade:</label>
                <input type="text" id="cidade-pix" placeholder="Ex: São Paulo">
            </div>
            <div class="form-group">
                <label for="banco-pix">Banco (opcional):</label>
                <input type="text" id="banco-pix" placeholder="Ex: Banco do Brasil">
            </div>
            <button onclick="salvarConfiguracoesPix()" class="btn btn-success">Salvar PIX</button>
            <button onclick="testarQRCode()" class="btn btn-secondary">🔍 Testar QR Code</button>
        </div>

        <!-- Preview das Configurações -->
        <div style="background: white; padding: 20px; border-radius: 10px; border: 2px solid #FFD700;">
            <h3 style="color: #DC143C; margin-bottom: 15px;">👀 Preview</h3>
            <div id="preview-configuracoes">
                <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                    <div id="preview-logo" style="margin-bottom: 10px;">
                        <div class="logo-placeholder">BL</div>
                    </div>
                    <h4 id="preview-nome-empresa">Bastos Lanches</h4>
                    <p id="preview-nome-sistema">Sistema de Venda Bastos</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Seção Relatórios -->
    <div id="relatorios" class="content-area">
        <h2>📊 Relatórios de Vendas</h2>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="total-vendas">0</div>
                <div>Total de Vendas</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="vendas-hoje">R$ 0,00</div>
                <div>Vendas Hoje</div>
            </div>
        </div>
        <div style="margin: 20px 0;">
            <h3 style="color: #DC143C;">Vendas por Data</h3>
            <div style="display: flex; gap: 15px; margin: 15px 0; flex-wrap: wrap;">
                <div class="form-group" style="max-width: 200px; margin: 0;">
                    <label for="filtro-data">Filtrar por data:</label>
                    <input type="date" id="filtro-data" onchange="filtrarVendasPorData()">
                </div>
                <div style="display: flex; gap: 10px; align-items: end;">
                    <button onclick="exportarDados()" class="btn btn-secondary">📊 Exportar Dados</button>
                    <button onclick="limparFiltros()" class="btn">🔄 Limpar Filtros</button>
                </div>
            </div>
        </div>
        <div id="lista-vendas"></div>
        <div style="margin: 30px 0;">
            <h3 style="color: #DC143C;">Gráfico de Vendas</h3>
            <div id="grafico-vendas"></div>
        </div>
    </div>

    <div id="alert-container" style="position: fixed; top: 20px; right: 20px; z-index: 3000;"></div>
</div>

<script>
    // Dados em memória
    let produtos = [];
    let vendas = [];
    let carrinho = [];
    let nextId = 1;
    let nextVendaId = 1;
    let formaPagamentoSelecionada = '';
    let totalCarrinho = 0;

    // Configurações do sistema
    let configuracoes = {
        nomeEmpresa: 'Bastos Lanches',
        nomeSistema: 'Sistema de Venda Bastos',
        urlLogo: 'bastos.jpeg',
        chavePixx: '',
        nomePixx: '',
        cidadePixx: '',
        bancoPixx: ''
    };

    // Funções de navegação
    function mostrarSecao(secaoId) {
        document.getElementById('main-menu').style.display = 'none';
        document.querySelector('.back-btn').style.display = 'block';
        
        const secoes = document.querySelectorAll('.content-area');
        secoes.forEach(s => s.classList.remove('active'));
        
        document.getElementById(secaoId).classList.add('active');
        
        if (secaoId === 'listar-produtos') {
            carregarListaProdutos();
        } else if (secaoId === 'nova-venda') {
            carregarProdutosVenda();
            atualizarCarrinho();
        } else if (secaoId === 'relatorios') {
            carregarRelatorios();
        } else if (secaoId === 'ajustes') {
            carregarAjustes();
        }
    }

    function voltarMenu() {
        document.getElementById('main-menu').style.display = 'grid';
        document.querySelector('.back-btn').style.display = 'none';
        
        const secoes = document.querySelectorAll('.content-area');
        secoes.forEach(s => s.classList.remove('active'));
    }

    function mostrarAlert(mensagem, tipo = 'success') {
        const alert = document.createElement('div');
        alert.className = `alert alert-${tipo}`;
        alert.textContent = mensagem;
        alert.style.cssText = `
            position: relative;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 500;
            animation: slideIn 0.3s ease;
            min-width: 300px;
            border: 2px solid ${tipo === 'success' ? '#FFD700' : '#DC143C'};
        `;
        
        if (tipo === 'success') {
            alert.style.background = '#d4edda';
            alert.style.color = '#155724';
        } else {
            alert.style.background = '#f8d7da';
            alert.style.color = '#721c24';
        }
        
        const container = document.getElementById('alert-container');
        container.appendChild(alert);
        
        setTimeout(() => {
            if (container.contains(alert)) {
                container.removeChild(alert);
            }
        }, 3000);
    }

    function validarEstoque(produtoId, quantidadeSolicitada) {
        const produto = produtos.find(p => p.id === produtoId);
        if (!produto) return false;
        
        if (produto.estoque === null) return true;
        
        const quantidadeNoCarrinho = carrinho
            .filter(item => item.id === produtoId)
            .reduce((total, item) => total + item.quantidade, 0);
        
        const estoqueDisponivel = produto.estoque - quantidadeNoCarrinho;
        return quantidadeSolicitada <= estoqueDisponivel;
    }

    // Cadastro de Produtos
    document.getElementById('form-produto').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const nome = document.getElementById('nome-produto').value.trim();
        const preco = parseFloat(document.getElementById('preco-produto').value);
        const estoque = document.getElementById('estoque-produto').value;
        
        if (!nome || preco <= 0) {
            mostrarAlert('Preencha todos os campos corretamente!', 'error');
            return;
        }
        
        const produto = {
            id: nextId++,
            nome: nome,
            preco: preco,
            estoque: estoque === '' ? null : parseInt(estoque)
        };
        
        produtos.push(produto);
        mostrarAlert(`Produto "${nome}" cadastrado com sucesso!`);
        this.reset();
    });

    function carregarListaProdutos() {
        const container = document.getElementById('lista-produtos');
        
        if (produtos.length === 0) {
            container.innerHTML = '<p>Nenhum produto cadastrado. Use o menu "Cadastrar Produto" para adicionar produtos.</p>';
            return;
        }
        
        let html = '<table class="table"><thead><tr><th>ID</th><th>Nome</th><th>Preço</th><th>Estoque</th></tr></thead><tbody>';
        
        produtos.forEach(produto => {
            html += `
                <tr>
                    <td>${produto.id}</td>
                    <td>${produto.nome}</td>
                    <td>R$ ${produto.preco.toFixed(2)}</td>
                    <td>${produto.estoque === null ? '∞' : produto.estoque}</td>
                </tr>
            `;
        });
        
        html += '</tbody></table>';
        container.innerHTML = html;
    }

    function carregarProdutosVenda() {
        const select = document.getElementById('produto-venda');
        select.innerHTML = '<option value="">Selecione um produto</option>';
        
        produtos.forEach(produto => {
            if (produto.estoque === null || produto.estoque > 0) {
                select.innerHTML += `<option value="${produto.id}">${produto.nome} - R$ ${produto.preco.toFixed(2)}</option>`;
            }
        });
    }

    function adicionarAoCarrinho() {
        const produtoId = parseInt(document.getElementById('produto-venda').value);
        const quantidade = parseInt(document.getElementById('quantidade-venda').value);
        
        if (!produtoId || !quantidade || quantidade <= 0) {
            mostrarAlert('Selecione um produto e quantidade válida!', 'error');
            return;
        }
        
        const produto = produtos.find(p => p.id === produtoId);
        if (!produto) {
            mostrarAlert('Produto não encontrado!', 'error');
            return;
        }
        
        if (!validarEstoque(produtoId, quantidade)) {
            mostrarAlert('Estoque insuficiente!', 'error');
            return;
        }
        
        const itemExistente = carrinho.find(item => item.id === produtoId);
        if (itemExistente) {
            if (!validarEstoque(produtoId, quantidade)) {
                mostrarAlert('Estoque insuficiente para adicionar mais unidades!', 'error');
                return;
            }
            itemExistente.quantidade += quantidade;
        } else {
            carrinho.push({
                id: produto.id,
                nome: produto.nome,
                preco: produto.preco,
                quantidade: quantidade
            });
        }
        
        atualizarCarrinho();
        mostrarAlert(`${quantidade}x ${produto.nome} adicionado ao carrinho!`);
        document.getElementById('quantidade-venda').value = 1;
        document.getElementById('produto-venda').value = '';
    }

    function editarQuantidadeCarrinho(index, novaQuantidade) {
        if (novaQuantidade <= 0) {
            removerDoCarrinho(index);
            return;
        }
        
        const item = carrinho[index];
        const produto = produtos.find(p => p.id === item.id);
        
        if (produto.estoque !== null) {
            const outrosItens = carrinho.filter((_, i) => i !== index && carrinho[i].id === item.id);
            const quantidadeOutros = outrosItens.reduce((total, outroItem) => total + outroItem.quantidade, 0);
            const estoqueDisponivel = produto.estoque - quantidadeOutros;
            
            if (novaQuantidade > estoqueDisponivel) {
                mostrarAlert('Estoque insuficiente para essa quantidade!', 'error');
                return;
            }
        }
        
        item.quantidade = novaQuantidade;
        atualizarCarrinho();
        mostrarAlert('Quantidade atualizada!');
    }

    function atualizarCarrinho() {
        const container = document.getElementById('carrinho-itens');
        
        if (carrinho.length === 0) {
            container.innerHTML = '<p>Carrinho vazio</p>';
            totalCarrinho = 0;
        } else {
            let html = '';
            totalCarrinho = 0;
            
            carrinho.forEach((item, index) => {
                const subtotal = item.quantidade * item.preco;
                totalCarrinho += subtotal;
                
                html += `
                    <div class="carrinho-item">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="number" value="${item.quantidade}" min="1" max="999" 
                                   onchange="editarQuantidadeCarrinho(${index}, parseInt(this.value))"
                                   style="width: 60px; padding: 5px; border: 1px solid #ddd; border-radius: 4px;">
                            <span>${item.nome}</span>
                        </div>
                        <div>R$ ${subtotal.toFixed(2)}</div>
                        <button onclick="removerDoCarrinho(${index})" class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;">Remover</button>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        document.getElementById('carrinho-total').textContent = `Total: R$ ${totalCarrinho.toFixed(2)}`;
    }

    function removerDoCarrinho(index) {
        const item = carrinho[index];
        carrinho.splice(index, 1);
        atualizarCarrinho();
        mostrarAlert(`${item.nome} removido do carrinho!`);
    }

    function limparCarrinho() {
        if (carrinho.length === 0) {
            mostrarAlert('Carrinho já está vazio!', 'error');
            return;
        }
        carrinho = [];
        atualizarCarrinho();
        mostrarAlert('Carrinho limpo!');
    }

    function finalizarVenda() {
        if (carrinho.length === 0) {
            mostrarAlert('Carrinho está vazio!', 'error');
            return;
        }
        
        document.getElementById('modal-finalizacao').style.display = 'block';
        
        let html = '<h4>Resumo da Venda:</h4>';
        carrinho.forEach(item => {
            const subtotal = item.quantidade * item.preco;
            html += `<div style="display: flex; justify-content: space-between; margin: 5px 0;">
                <span>${item.quantidade}x ${item.nome}</span>
                <span>R$ ${subtotal.toFixed(2)}</span>
            </div>`;
        });
        html += `<div style="font-weight: bold; margin-top: 15px; padding-top: 10px; border-top: 2px solid #ddd; display: flex; justify-content: space-between;">
            <span>Total:</span>
            <span>R$ ${totalCarrinho.toFixed(2)}</span>
        </div>`;
        
        document.getElementById('resumo-venda').innerHTML = html;
        formaPagamentoSelecionada = '';
        document.getElementById('pagamento-dinheiro').style.display = 'none';
        document.querySelectorAll('.payment-method').forEach(el => el.classList.remove('selected'));
    }

    function selecionarPagamento(forma) {
        document.querySelectorAll('.payment-method').forEach(el => el.classList.remove('selected'));
        
        event.target.closest('.payment-method').classList.add('selected');
        formaPagamentoSelecionada = forma;
        
        // Esconder todas as seções de pagamento
        document.getElementById('pagamento-dinheiro').style.display = 'none';
        document.getElementById('pagamento-pix').style.display = 'none';
        
        if (forma === 'dinheiro') {
            document.getElementById('pagamento-dinheiro').style.display = 'block';
            document.getElementById('valor-pago').value = totalCarrinho.toFixed(2);
            calcularTroco();
            document.getElementById('valor-pago').addEventListener('input', calcularTroco);
        } else if (forma === 'pix') {
            document.getElementById('pagamento-pix').style.display = 'block';
            gerarQRCodePix();
        }
    }

    function calcularTroco() {
        const valorPago = parseFloat(document.getElementById('valor-pago').value) || 0;
        const troco = valorPago - totalCarrinho;
        
        if (valorPago >= totalCarrinho) {
            document.getElementById('troco-info').innerHTML = `<div style="color: green; font-weight: bold; margin-top: 10px;">Troco: R$ ${troco.toFixed(2)}</div>`;
        } else {
            document.getElementById('troco-info').innerHTML = `<div style="color: red; font-weight: bold; margin-top: 10px;">Valor insuficiente! Faltam R$ ${(totalCarrinho - valorPago).toFixed(2)}</div>`;
        }
    }

    function confirmarVenda() {
        if (!formaPagamentoSelecionada) {
            mostrarAlert('Selecione uma forma de pagamento!', 'error');
            return;
        }
        
        let valorPago = totalCarrinho;
        let troco = 0;
        
        if (formaPagamentoSelecionada === 'dinheiro') {
            valorPago = parseFloat(document.getElementById('valor-pago').value) || 0;
            if (valorPago < totalCarrinho) {
                mostrarAlert('Valor pago insuficiente!', 'error');
                return;
            }
            troco = valorPago - totalCarrinho;
        }
        
        // Atualizar estoque
        carrinho.forEach(item => {
            const produto = produtos.find(p => p.id === item.id);
            if (produto && produto.estoque !== null) {
                produto.estoque -= item.quantidade;
            }
        });
        
        // Registrar venda
        const venda = {
            id: nextVendaId++,
            data: new Date().toISOString(),
            itens: carrinho.map(i => `${i.quantidade}x ${i.nome}`).join('; '),
            total: totalCarrinho,
            pago: valorPago,
            troco: troco,
            formaPagamento: formaPagamentoSelecionada
        };
        
        vendas.push(venda);
        
        carrinho = [];
        atualizarCarrinho();
        
        fecharModal();
        mostrarAlert(`Venda #${venda.id} finalizada com sucesso! Troco: R$ ${troco.toFixed(2)}`);
    }

    function fecharModal() {
        document.getElementById('modal-finalizacao').style.display = 'none';
        document.getElementById('valor-pago').value = '';
        document.getElementById('troco-info').innerHTML = '';
        document.querySelectorAll('.payment-method').forEach(el => el.classList.remove('selected'));
    }

    function gerarRelatorioDetalhado() {
        const hoje = new Date().toISOString().split('T')[0];
        const ontem = new Date(Date.now() - 86400000).toISOString().split('T')[0];
        
        const vendasHoje = vendas.filter(v => v.data.startsWith(hoje));
        const vendasOntem = vendas.filter(v => v.data.startsWith(ontem));
        
        const totalHoje = vendasHoje.reduce((sum, v) => sum + v.total, 0);
        const totalOntem = vendasOntem.reduce((sum, v) => sum + v.total, 0);
        
        const produtosVendidos = {};
        vendas.forEach(venda => {
            const itens = venda.itens.split('; ');
            itens.forEach(item => {
                const match = item.match(/(\d+)x (.+)/);
                if (match) {
                    const quantidade = parseInt(match[1]);
                    const nome = match[2];
                    produtosVendidos[nome] = (produtosVendidos[nome] || 0) + quantidade;
                }
            });
        });
        
        return {
            totalVendas: vendas.length,
            totalHoje,
            totalOntem,
            crescimento: totalOntem > 0 ? ((totalHoje - totalOntem) / totalOntem * 100).toFixed(1) : 0,
            produtoMaisVendido: Object.entries(produtosVendidos).sort((a, b) => b[1] - a[1])[0],
            ticketMedio: vendas.length > 0 ? (vendas.reduce((sum, v) => sum + v.total, 0) / vendas.length).toFixed(2) : 0
        };
    }

    function carregarRelatorios() {
        const relatorio = gerarRelatorioDetalhado();
        
        const statsContainer = document.querySelector('.stats-grid');
        statsContainer.innerHTML = `
            <div class="stat-card">
                <div class="stat-number">${relatorio.totalVendas}</div>
                <div>Total de Vendas</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">R$ ${relatorio.totalHoje.toFixed(2)}</div>
                <div>Vendas Hoje</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">R$ ${relatorio.ticketMedio}</div>
                <div>Ticket Médio</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">${relatorio.crescimento}%</div>
                <div>Crescimento (vs ontem)</div>
            </div>
        `;
        
        if (relatorio.produtoMaisVendido) {
            statsContainer.innerHTML += `
                <div class="stat-card">
                    <div class="stat-number">${relatorio.produtoMaisVendido[1]}</div>
                    <div>+ Vendido: ${relatorio.produtoMaisVendido[0]}</div>
                </div>
            `;
        }
        
        carregarListaVendas();
        carregarGraficoVendas();
    }

    function carregarListaVendas(dataFiltro = null) {
        const container = document.getElementById('lista-vendas');
        
        let vendasFiltradas = vendas;
        if (dataFiltro) {
            vendasFiltradas = vendas.filter(v => v.data.startsWith(dataFiltro));
        }
        
        if (vendasFiltradas.length === 0) {
            container.innerHTML = '<p>Nenhuma venda encontrada.</p>';
            return;
        }
        
        let html = '<table class="table"><thead><tr><th>ID</th><th>Data/Hora</th><th>Itens</th><th>Total</th><th>Pagamento</th><th>Troco</th></tr></thead><tbody>';
        
        vendasFiltradas.reverse().forEach(venda => {
            const data = new Date(venda.data).toLocaleString('pt-BR');
            html += `
                <tr>
                    <td>#${venda.id}</td>
                    <td>${data}</td>
                    <td>${venda.itens}</td>
                    <td>R$ ${venda.total.toFixed(2)}</td>
                    <td>${venda.formaPagamento.toUpperCase()}</td>
                    <td>R$ ${venda.troco.toFixed(2)}</td>
                </tr>
            `;
        });
        
        html += '</tbody></table>';
        
        const totalFiltrado = vendasFiltradas.reduce((sum, v) => sum + v.total, 0);
        html += `<div style="text-align: right; margin-top: 15px; font-weight: bold; font-size: 1.2em;">
            Total: R$ ${totalFiltrado.toFixed(2)} (${vendasFiltradas.length} vendas)
        </div>`;
        
        container.innerHTML = html;
    }

    function filtrarVendasPorData() {
        const data = document.getElementById('filtro-data').value;
        carregarListaVendas(data);
    }

    function limparFiltros() {
        document.getElementById('filtro-data').value = '';
        carregarListaVendas();
    }

    function carregarGraficoVendas() {
        const container = document.getElementById('grafico-vendas');
        
        if (vendas.length === 0) {
            container.innerHTML = '<p>Nenhuma venda para exibir no gráfico.</p>';
            return;
        }
        
        const vendasPorDia = {};
        vendas.forEach(venda => {
            const data = venda.data.split('T')[0];
            vendasPorDia[data] = (vendasPorDia[data] || 0) + venda.total;
        });
        
        const maxVenda = Math.max(...Object.values(vendasPorDia));
        
        let html = '';
        Object.entries(vendasPorDia).sort().forEach(([data, total]) => {
            const largura = maxVenda > 0 ? (total / maxVenda) * 100 : 0;
            const dataFormatada = new Date(data + 'T00:00:00').toLocaleDateString('pt-BR');
            
            html += `
                <div class="chart-bar">
                    <div class="chart-date">${dataFormatada}</div>
                    <div class="chart-value" style="width: ${largura}%"></div>
                    <div class="chart-amount">R$ ${total.toFixed(2)}</div>
                </div>
            `;
        });
        
        container.innerHTML = html;
    }

    function exportarDados() {
        const dados = {
            produtos,
            vendas,
            configuracoes,
            relatorio: gerarRelatorioDetalhado(),
            dataExportacao: new Date().toISOString(),
            versao: "Bastos Lanches PDV v1.0"
        };
        
        const jsonString = JSON.stringify(dados, null, 2);
        const blob = new Blob([jsonString], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `bastos_lanches_backup_${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        
        URL.revokeObjectURL(url);
        mostrarAlert('Dados exportados com sucesso!');
    }

    // ==================== FUNÇÕES DE AJUSTES ====================
    
    function carregarAjustes() {
        // Carregar valores atuais nos campos
        document.getElementById('nome-sistema').value = configuracoes.nomeSistema;
        document.getElementById('nome-empresa').value = configuracoes.nomeEmpresa;
        document.getElementById('url-logo').value = configuracoes.urlLogo;
        document.getElementById('chave-pix').value = configuracoes.chavePixx;
        document.getElementById('nome-pix').value = configuracoes.nomePixx;
        document.getElementById('cidade-pix').value = configuracoes.cidadePixx;
        document.getElementById('banco-pix').value = configuracoes.bancoPixx;
        
        atualizarPreview();
    }

    function salvarConfiguracoesGerais() {
        configuracoes.nomeSistema = document.getElementById('nome-sistema').value.trim() || 'Sistema PDV';
        configuracoes.nomeEmpresa = document.getElementById('nome-empresa').value.trim() || 'Minha Empresa';
        configuracoes.urlLogo = document.getElementById('url-logo').value.trim() || 'bastos.jpeg';
        
        atualizarInterface();
        atualizarPreview();
        mostrarAlert('Configurações gerais salvas com sucesso!');
    }

    function salvarConfiguracoesPix() {
        configuracoes.chavePixx = document.getElementById('chave-pix').value.trim();
        configuracoes.nomePixx = document.getElementById('nome-pix').value.trim();
        configuracoes.cidadePixx = document.getElementById('cidade-pix').value.trim();
        configuracoes.bancoPixx = document.getElementById('banco-pix').value.trim();
        
        if (!configuracoes.chavePixx || !configuracoes.nomePixx) {
            mostrarAlert('Preencha pelo menos a Chave PIX e o Nome do Recebedor!', 'error');
            return;
        }
        
        mostrarAlert('Configurações PIX salvas com sucesso!');
    }

    function atualizarInterface() {
        // Atualizar título e subtítulo
        document.getElementById('titulo-empresa').textContent = configuracoes.nomeEmpresa;
        document.getElementById('subtitulo-sistema').textContent = configuracoes.nomeSistema;
        
        // Atualizar logo
        const logoImg = document.getElementById('logo-imagem');
        if (configuracoes.urlLogo && configuracoes.urlLogo !== '') {
            logoImg.src = configuracoes.urlLogo;
            logoImg.style.display = 'block';
            logoImg.onerror = function() {
                // Se a imagem não carregar, mostrar placeholder
                const logoContainer = document.getElementById('logo-container');
                logoContainer.innerHTML = '<div class="logo-placeholder">BL</div>';
            };
        } else {
            const logoContainer = document.getElementById('logo-container');
            logoContainer.innerHTML = '<div class="logo-placeholder">BL</div>';
        }
    }

    function atualizarPreview() {
        // Atualizar preview
        document.getElementById('preview-nome-empresa').textContent = configuracoes.nomeEmpresa;
        document.getElementById('preview-nome-sistema').textContent = configuracoes.nomeSistema;
        
        const previewLogo = document.getElementById('preview-logo');
        if (configuracoes.urlLogo && configuracoes.urlLogo !== '') {
            previewLogo.innerHTML = `<img src="${configuracoes.urlLogo}" alt="Logo Preview" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 2px solid #DC143C;">`;
        } else {
            previewLogo.innerHTML = '<div class="logo-placeholder" style="width: 60px; height: 60px; font-size: 24px;">BL</div>';
        }
    }

    function testarQRCode() {
        if (!configuracoes.chavePixx || !configuracoes.nomePixx) {
            mostrarAlert('Configure as informações PIX primeiro!', 'error');
            return;
        }
        
        // Simular geração de QR Code com valor de teste
        const valorTeste = 10.00;
        gerarQRCodePixTeste(valorTeste);
        mostrarAlert('QR Code de teste gerado! (Valor: R$ 10,00)');
    }

    function gerarQRCodePix() {
        if (!configuracoes.chavePixx || !configuracoes.nomePixx) {
            document.getElementById('qr-code-placeholder').innerHTML = `
                <div style="color: #DC143C; text-align: center;">
                    <p><strong>Configure o PIX</strong></p>
                    <p>Vá em Ajustes para configurar as informações PIX</p>
                </div>
            `;
            return;
        }
        
        // Atualizar informações PIX
        document.getElementById('valor-pix').textContent = totalCarrinho.toFixed(2);
        document.getElementById('nome-recebedor-pix').innerHTML = `<strong>Recebedor:</strong> ${configuracoes.nomePixx}`;
        
        if (configuracoes.bancoPixx) {
            document.getElementById('banco-info-pix').innerHTML = `<p><strong>Banco:</strong> ${configuracoes.bancoPixx}</p>`;
        } else {
            document.getElementById('banco-info-pix').innerHTML = '';
        }
        
        // Gerar QR Code usando API pública (exemplo)
        const pixData = gerarStringPix(configuracoes.chavePixx, configuracoes.nomePixx, configuracoes.cidadePixx, totalCarrinho);
        const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(pixData)}`;
        
        document.getElementById('qr-code-placeholder').innerHTML = `
            <img src="${qrCodeUrl}" alt="QR Code PIX" style="max-width: 100%; border-radius: 10px; border: 3px solid #FFD700;">
        `;
    }

    function gerarQRCodePixTeste(valor) {
        const pixData = gerarStringPix(configuracoes.chavePixx, configuracoes.nomePixx, configuracoes.cidadePixx, valor);
        const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(pixData)}`;
        
        // Mostrar em um modal simples
        const modal = document.createElement('div');
        modal.style.cssText = `
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 9999; display: flex;
            align-items: center; justify-content: center;
        `;
        modal.innerHTML = `
            <div style="background: white; padding: 30px; border-radius: 15px; text-align: center; max-width: 400px;">
                <h3 style="color: #DC143C; margin-bottom: 20px;">QR Code PIX - Teste</h3>
                <img src="${qrCodeUrl}" alt="QR Code Test" style="max-width: 100%; border-radius: 10px;">
                <p style="margin: 15px 0;"><strong>Valor:</strong> R$ ${valor.toFixed(2)}</p>
                <p style="margin: 15px 0;"><strong>Recebedor:</strong> ${configuracoes.nomePixx}</p>
                <button onclick="this.parentElement.parentElement.remove()" style="
                    background: #DC143C; color: white; border: none; padding: 10px 20px;
                    border-radius: 5px; cursor: pointer; margin-top: 15px;
                ">Fechar</button>
            </div>
        `;
        document.body.appendChild(modal);
    }

    function gerarStringPix(chave, nome, cidade, valor) {
        // Função simplificada para gerar string PIX
        // Em produção, use uma biblioteca específica para PIX
        const valorFormatado = valor.toFixed(2);
        return `00020126330014br.gov.bcb.pix0111${chave}52040000530398654${valorFormatado.length.toString().padStart(2, '0')}${valorFormatado}5802BR5913${nome.substring(0, 25)}6009${cidade.substring(0, 15)}62070503***6304`;
    }

    // Inicializar sistema
    document.addEventListener('DOMContentLoaded', function() {
        // Carregar interface inicial
        atualizarInterface();
        
        // Adicionar alguns produtos de exemplo (opcional)
        /*
        produtos.push(
            { id: 1, nome: 'X-Burguer', preco: 15.90, estoque: 50 },
            { id: 2, nome: 'X-Salada', preco: 18.50, estoque: 30 },
            { id: 3, nome: 'Batata Frita', preco: 8.90, estoque: 100 },
            { id: 4, nome: 'Refrigerante', preco: 5.50, estoque: null },
            { id: 5, nome: 'Suco Natural', preco: 7.90, estoque: 20 }
        );
        nextId = 6;
        */
    });

    // Fechar modal ao clicar fora
    document.getElementById('modal-finalizacao').addEventListener('click', function(e) {
        if (e.target === this) {
            fecharModal();
        }
    });

    // Atalhos de teclado
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            const modal = document.getElementById('modal-finalizacao');
            if (modal.style.display !== 'none') {
                fecharModal();
            }
        }
        
        if (e.ctrlKey && e.key === 'Enter') {
            if (document.getElementById('nova-venda').classList.contains('active') && carrinho.length > 0) {
                finalizarVenda();
            }
        }
    });
</script>


</body>
</html>